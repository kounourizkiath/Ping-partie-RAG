Source: https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html
Scraped: 2025-12-22 20:48:02
================================================================================

XML External Entity Prevention - OWASP Cheat Sheet Series
XML External Entity Prevention Cheat Sheet
XML eXternal Entity injection
(XXE), which is now part of the
, is attack against applications that parse XML input. This issue is referenced in the ID
Common Weakness Enumeration
referential. An XXE attack occurs when untrusted XML input with a
reference to an external entity is processed by a weakly configured XML parser
, and this attack could be used to stage multiple incidents, including:
A denial of service attack on the system
Server Side Request Forgery
The ability to scan ports from the machine where the parser is located
Other system impacts.
This cheat sheet will help you prevent this vulnerability.
For more information on XXE, please visit
XML External Entity (XXE)
The safest way to prevent XXE is always to disable DTDs (External Entities) completely.
Depending on the parser, the method should be similar to the following:
"http://apache.org/xml/features/disallow-doctype-decl"
s also makes the parser secure against denial of services (DOS) attacks such as
If it is not possible to disable DTDs completely, then external entities and external document type declarations must be disabled in the way that's specific to each parser.
XML Parser Security Features Matrix
Default (Parser-Dependent)
What Happens If Missing?
External Entities Disabled
Blocks external resource loading
Full XXE possible → SSRF, file disclosure, internal scans
Disallow DOCTYPE Declaration
Prevents ENTITY definitions
Classic XXE payloads become fully functional
Disable External DTD Loading
Stops loading remote DTDs
Enables Blind XXE, SSRF behind firewalls
Secure Processing Mode
Restricts recursion, network access, entity expansion
Billion Laughs DoS and resource depletion become possible
Disable Parameter Entities
Advanced XXE payloads bypass simple protections
Prevents including external files
and SSRF becomes possible
Limit Entity Expansion Count
Prevents recursive entity abuse
Memory exhaustion → parser or server DoS
Schema Validation Without External Fetching
Ensures validation does not fetch external URLs
Silent external HTTP calls triggered during validation
Quick Impact Matrix (What Happens If Missing?)
Resulting Vulnerability
Standard XXE fully exploitable
External entities enabled
SSRF, file exfiltration, port scanning
External DTD loading allowed
Blind XXE → hidden SSRF attacks
Local file disclosure + SSRF
Secure processing disabled
Critical protections bypassed
Schema validation fetches external URLs
Application makes unwanted outbound requests
Minimal XML Hardening Rules
Disable external entities
Disable external DTD loading
Enable secure processing mode
Limit entity expansion
Do not use legacy XML parsers
Never parse untrusted XML with default settings
Detailed XXE Prevention guidance is provided below for multiple languages (C++, Cold Fusion, Java, .NET, iOS, PHP, Python, Semgrep Rules) and their commonly used XML parsers.
should not have the following options defined:
: Expands entities and substitutes them with replacement text
: Load the external DTD
, starting with libxml2 version 2.9, XXE has been disabled by default as committed by the following
Search whether the following APIs are being used and make sure there is no
defined in the parameters:
xmlParseInNodeContext
do this to prevent XXE:
setCreateEntityReferenceNodes
setDisableDefaultEntityResolution
Use of SAXParser, do this to prevent XXE:
setDisableDefaultEntityResolution
Use of SAX2XMLReader, do this to prevent XXE:
fgXercesDisableDefaultEntityResolution
, both Adobe ColdFusion and Lucee have built-in mechanisms to disable support for external XML entities.
As of ColdFusion 2018 Update 14 and ColdFusion 2021 Update 4, all native ColdFusion functions that process XML have a XML parser argument that disables support for external XML entities. Since there is no global setting that disables external entities, developers must ensure that every XML function call uses the correct security options.
documentation for the XmlParse() function
, you can disable XXE with the code below:
<cfset parseroptions = structnew()>
<cfset parseroptions.ALLOWEXTERNALENTITIES = false>
a = XmlParse("xml.xml", false, parseroptions);
You can use the "parseroptions" structure shown above as an argument to secure other functions that process XML as well, such as:
XxmlSearch(xmldoc, xpath,parseroptions);
XmlTransform(xmldoc,xslt,parseroptions);
isXML(xmldoc,parseroptions);
As of Lucee 5.3.4.51 and later, you can disable support for XML external entities by adding the following to your Application.cfc:
externalGeneralEntities: false,
disallowDoctypeDecl: true
Support for external XML entities is disabled by default as of Lucee 5.4.2.10 and Lucee 6.0.0.514.
Since most Java XML parsers have XXE enabled by default, this language is especially vulnerable to XXE attack, so you must explicitly disable XXE to use these parsers safely.
This section describes how to disable XXE in the most commonly used Java XML parsers.
JAXP DocumentBuilderFactory, SAXParserFactory and DOM4J
DocumentBuilderFactory,
parsers can be protected against XXE attacks with the same techniques.
For brevity, we will only show you how to protect the
DocumentBuilderFactory
parser. Additional instructions for protecting this parser are embedded within the example code
DocumentBuilderFactory
method allows a developer to control which implementation-specific XML processor features are enabled or disabled.
These features can either be set on the factory or the underlying
Each XML processor implementation has its own features that govern how DTDs and external entities are processed. By disabling DTD processing entirely, most XXE attacks can be averted, although it is also necessary to disable or verify that XInclude is not enabled.
Since the JDK 6, the flag
FEATURE_SECURE_PROCESSING
can be used to instruct the implementation of the parser to process XML securely
. Its behavior is implementation-dependent. It may help with resource exhaustion but it may not always mitigate entity expansion. More details on this flag can be found
For a syntax highlighted example code snippet using
Example code disabling DTDs (doctypes) altogether:
javax.xml.parsers.DocumentBuilderFactory
javax.xml.parsers.ParserConfigurationException
// catching unsupported features
javax.xml.XMLConstants
DocumentBuilderFactory
DocumentBuilderFactory
// This is the PRIMARY defense. If DTDs (doctypes) are disallowed, almost all
// XML entity attacks are prevented
// Xerces 2 only - http://xerces.apache.org/xerces2-j/features.html#disallow-doctype-decl
"http://apache.org/xml/features/disallow-doctype-decl"
// and these as well, per Timothy Morgan's 2014 paper: "XML Schema, DTD, and Entity Attacks"
// remaining parser logic
ParserConfigurationException
// This should catch a failed setFeature feature
// NOTE: Each call to setFeature() should be in its own try/catch otherwise subsequent calls will be skipped.
// This is only important if you're ignoring errors for multi-provider support.
"ParserConfigurationException was thrown. The feature '"
"' is not supported by your XML processor."
// On Apache, this should be thrown when disallowing DOCTYPE
"A DOCTYPE was passed into the XML document"
// XXE that points to a file that doesn't exist
"IOException occurred, XXE may still possible: "
// Load XML file or stream using a XXE agnostic configured parser...
If you can't completely disable DTDs:
javax.xml.parsers.DocumentBuilderFactory
javax.xml.parsers.ParserConfigurationException
// catching unsupported features
javax.xml.XMLConstants
DocumentBuilderFactory
DocumentBuilderFactory
// Xerces 1 - http://xerces.apache.org/xerces-j/features.html#external-general-entities
// Xerces 2 - http://xerces.apache.org/xerces2-j/features.html#external-general-entities
// JDK7+ - http://xml.org/sax/features/external-general-entities
//This feature has to be used together with the following one, otherwise it will not protect you from XXE for sure
"http://xml.org/sax/features/external-general-entities"
// Xerces 1 - http://xerces.apache.org/xerces-j/features.html#external-parameter-entities
// Xerces 2 - http://xerces.apache.org/xerces2-j/features.html#external-parameter-entities
// JDK7+ - http://xml.org/sax/features/external-parameter-entities
//This feature has to be used together with the previous one, otherwise it will not protect you from XXE for sure
"http://xml.org/sax/features/external-parameter-entities"
// Disable external DTDs as well
"http://apache.org/xml/features/nonvalidating/load-external-dtd"
ParserConfigurationException
// This should catch a failed setFeature feature
"ParserConfigurationException was thrown. The feature '"
"' is probably not supported by your XML processor."
// Add these as per Timothy Morgan's 2014 paper: "XML Schema, DTD, and Entity Attacks"
setExpandEntityReferences
// As stated in the documentation, "Feature for Secure Processing (FSP)" is the central mechanism that will
// help you safeguard XML processing. It instructs XML processors, such as parsers, validators,
// and transformers, to try and process XML securely, and the FSP can be used as an alternative to
// dbf.setExpandEntityReferences(false); to allow some safe level of Entity Expansion
FEATURE_SECURE_PROCESSING
// And, per Timothy Morgan: "If for some reason support for inline DOCTYPEs are a requirement, then
// ensure the entity settings are disabled (as shown above) and beware that SSRF attacks
// (http://cwe.mitre.org/data/definitions/918.html) and denial
// of service attacks (such as billion laughs or decompression bombs via "jar:") are a risk."
// remaining parser logic
ParserConfigurationException
// This should catch a failed setFeature feature
"ParserConfigurationException was thrown. The feature 'XMLConstants.FEATURE_SECURE_PROCESSING'"
" is probably not supported by your XML processor."
// On Apache, this should be thrown when disallowing DOCTYPE
"A DOCTYPE was passed into the XML document"
// XXE that points to a file that doesn't exist
"IOException occurred, XXE may still possible: "
// Load XML file or stream using a XXE agnostic configured parser...
Do not include external entities by setting
Do not include parameter entities by setting
Do not include external DTDs by setting
Disallow an inline DTD by setting
Do not include external entities by setting
Do not include parameter entities by setting
Do not include external DTDs by setting
The above defenses require Java 7 update 67, Java 8 update 20, or above, because the countermeasures for
DocumentBuilderFactory
and SAXParserFactory are broken in earlier Java versions, per:
XMLInputFactory (a StAX parser)
allow various properties and features to be set.
from XXE, disable DTDs (doctypes) altogether:
// This disables DTDs entirely for that factory
or if you can't completely disable DTDs:
// This causes XMLStreamException to be thrown if external DTDs are accessed.
// disable external entities
"javax.xml.stream.isSupportingExternalEntities"
xmlInputFactory.setProperty(XMLConstants.ACCESS_EXTERNAL_SCHEMA, "");
is not required, as XMLInputFactory is dependent on Validator to perform XML validation against Schemas. Check the
section for the specific configuration.
Oracle recommendation
// Extend oracle.xml.parser.v2.XMLParser
// Do not expand entity references
// dtdObj is an instance of oracle.xml.parser.v2.DTD
// Do not allow more than 11 levels of entity expansion
ENTITY_EXPANSION_DEPTH
javax.xml.transform.TransformerFactory
ACCESS_EXTERNAL_STYLESHEET
javax.xml.validation.Validator
"http://www.w3.org/2001/XMLSchema"
ACCESS_EXTERNAL_SCHEMA
ACCESS_EXTERNAL_SCHEMA
javax.xml.validation.SchemaFactory
"http://www.w3.org/2001/XMLSchema"
ACCESS_EXTERNAL_SCHEMA
SAXTransformerFactory
javax.xml.transform.sax.SAXTransformerFactory
SAXTransformerFactory
SAXTransformerFactory
ACCESS_EXTERNAL_STYLESHEET
Note: Use of the following
requires JAXP 1.5, which was added to Java in 7u40 and Java 8:
javax.xml.XMLConstants.ACCESS_EXTERNAL_DTD
javax.xml.XMLConstants.ACCESS_EXTERNAL_SCHEMA
javax.xml.XMLConstants.ACCESS_EXTERNAL_STYLESHEET
org.xml.sax.XMLReader
from an XXE attack, do this:
"http://apache.org/xml/features/disallow-doctype-decl"
// This may not be strictly required as DTDs shouldn't be allowed at all, per previous line.
"http://apache.org/xml/features/nonvalidating/load-external-dtd"
"http://xml.org/sax/features/external-general-entities"
"http://xml.org/sax/features/external-parameter-entities"
org.dom4j.io.SAXReader
from an XXE attack, do this:
"http://apache.org/xml/features/disallow-doctype-decl"
"http://xml.org/sax/features/external-general-entities"
"http://xml.org/sax/features/external-parameter-entities"
If your code does not have all of these lines, you could be vulnerable to an XXE attack.
org.jdom2.input.SAXBuilder
from an XXE attack, disallow DTDs (doctypes) entirely:
"http://apache.org/xml/features/disallow-doctype-decl"
Alternatively, if DTDs can't be completely disabled, disable external entities and entity expansion:
"http://xml.org/sax/features/external-general-entities"
"http://xml.org/sax/features/external-parameter-entities"
"http://apache.org/xml/features/nonvalidating/load-external-dtd"
For APIs that take an
, you can neutralize an XML parser's ability to resolve entities by
supplying a no-op implementation
You should ensure that the source to the
javax.xml.bind.Unmarshaller
javax.xml.stream.XMLStreamReader
that was generated using
javax.xml.stream.XMLInputFactory
with safe properties, i.e.
XMLInputFactory.SUPPORT_DTD
XMLInputFactory.IS_SUPPORTING_EXTERNAL_ENTITIES
IS_SUPPORTING_EXTERNAL_ENTITIES
createXMLStreamReader
createXMLStreamReader
methods have several overloads with various source types, so you need to pick the right one and do a possible conversion.
javax.xml.xpath.XPathExpression
can not be configured securely by itself, the untrusted data must be parsed through another securable XML parser first.
DocumentBuilderFactory
DocumentBuilderFactory
ACCESS_EXTERNAL_SCHEMA
java.beans.XMLDecoder
method in this class is fundamentally unsafe.
Not only is the XML it parses subject to XXE, but the method can be used to construct any Java object, and
execute arbitrary code as described here
And there is no way to make use of this class safe except to trust or properly validate the input being passed into it.
As such, we'd strongly recommend completely avoiding the use of this class and replacing it with a safe or properly configured XML parser as described elsewhere in this cheat sheet.
There are many third-party libraries that parse XML either directly or through their use of other libraries. Please test and verify their XML parser is secure against XXE by default.
If the parser is not secure by default, look for flags supported by the parser to disable all possible external resource inclusions like the examples given above. If there's no control exposed to the outside, make sure the untrusted content is passed through a secure parser first and then passed to insecure third-party parser similar to how the Unmarshaller is secured.
Spring Framework MVC/OXM XXE Vulnerabilities
**Some XXE vulnerabilities were found in
. The following versions of the Spring Framework are vulnerable to XXE:
(Spring OXM & Spring MVC)
There were other issues as well that were fixed later, so to fully address these issues, Spring recommends you upgrade to Spring Framework 3.2.8+ or 4.0.2+.
For Spring OXM, this is referring to the use of org.springframework.oxm.jaxb.Jaxb2Marshaller.
Note that the CVE for Spring OXM specifically indicates that two XML parsing situations are up to the developer to get right, and the other two are the responsibility of Spring and were fixed to address this CVE.
Here's what they say:
Two situations developers must handle:
, the XML has already been parsed by user code and that code is responsible for protecting against XXE.
, the XMLStreamReader has already been created by user code and that code is responsible for protecting against XXE.
The issue Spring fixed:
For SAXSource and StreamSource instances, Spring processed external entities by default thereby creating this vulnerability.
Here's an example of using a StreamSource that was vulnerable, but is now safe, if you are using a fixed version of Spring OXM or Spring MVC:
org.springframework.oxm.Jaxb2Marshaller
org.springframework.oxm.jaxb.Jaxb2Marshaller
// Must cast return Object to whatever type you are unmarshalling
some_string_containing_XML
Spring OXM CVE writeup
, the above is now safe. But if you were to use a DOMSource or StAXSource instead, it would be up to you to configure those sources to be safe from XXE.
Castor is a data binding framework for Java. It allows conversion between Java objects, XML, and relational tables. The XML features in Castor prior to version 1.3.3 are vulnerable to XXE, and should be upgraded to the latest version.
For additional information, check the official
XML configuration file
Up-to-date information for XXE injection in .NET is taken directly from the
web application of unit tests by Dean Fleming
, which covers all currently supported .NET XML parsers, and has test cases that demonstrate when they are safe from XXE injection and when they are not, but these tests are only with injection from file and not direct DTD (used by DoS attacks).
For DoS attacks using a direct DTD (such as the
Billion laughs attack
separate testing application from Josh Grossman at Bounce Security
has been created to verify that .NET >=4.5.2 is safe from these attacks.
Previously, this information was based on some older articles which may not be 100% accurate including:
James Jardine's excellent .NET XXE article
Guidance from Microsoft on how to prevent XXE and XML Denial of Service in .NET
Overview of .NET Parser Safety Levels
**Below is an overview of all supported .NET XML parsers and their default safety levels. More details about each parser are included after this list.
**XDocument (LINQ to XML)
This parser is protected from external entities at .NET Framework version 4.5.2 and protected from Billion Laughs at version 4.5.2 or greater, but it is uncertain if this parser is protected from Billion Laughs before version 4.5.2.
XmlDocument, XmlTextReader, XPathNavigator default safety levels
These parsers are vulnerable to external entity attacks and Billion Laughs at versions below version 4.5.2 but protected at versions equal or greater than 4.5.2.
XmlDictionaryReader, XmlNodeReader, XmlReader default safety levels
These parsers are not vulnerable to external entity attacks or Billion Laughs before or after version 4.5.2. Also, at or greater than versions ≥4.5.2, these libraries won't even process the in-line DTD by default. Even if you change the default to allow processing a DTD, if a DoS attempt is performed an exception will still be thrown as documented above.
ASP.NET applications ≥ .NET 4.5.2 must also ensure setting the
<httpRuntime targetFramework="..." />
to ≥4.5.2 or risk being vulnerable regardless or the actual .NET version. Omitting this tag will also result in unsafe-by-default behavior.
For the purpose of understanding the above table, the
.NET Framework Version
for an ASP.NET applications is either the .NET version the application was build with or the httpRuntime's
This configuration tag should not be confused with a similar configuration tag:
<compilation targetFramework="..." />
or the assemblies / projects targetFramework, which are
sufficient for achieving secure-by-default behaviour as advertised in the above table.
library are safe from XXE injection from external file and DoS attack by default.
parses only the elements within the XML file, so DTDs are ignored altogether.
so it's safe from SSRF. Whilst DTDs are
, from Framework versions ≥4.5.2, it is
vulnerable to DoS as noted but it may be vulnerable in earlier Framework versions. For more information, see
Microsoft's guidance on how to prevent XXE and XML Denial of Service in .NET
System.Xml.XmlDictionaryReader
is safe by default, as when it attempts to parse the DTD, the compiler throws an exception saying that "CData elements not valid at top level of an XML document". It becomes unsafe if constructed with a different unsafe XML parser.
Prior to .NET Framework version 4.5.2,
System.Xml.XmlDocument
is unsafe by default. The
object within it that needs to be set to null in versions prior to 4.5.2. In versions 4.5.2 and up, this
is set to null by default.
The following example shows how it is made safe:
"<!DOCTYPE doc [<!ENTITY win SYSTEM 'file:///C:/Users/testdata2.txt'>]>"
"<?xml version='1.0' ?>"
// Setting this to NULL disables DTDs - Its NOT null by default.
For .NET Framework version ≥4.5.2, this is safe by default
can become unsafe if you create your own nonnull
with default or unsafe settings. If you need to enable DTD processing, instructions on how to do so safely are described in detail in the
referenced MSDN article
System.Xml.XmlNodeReader
objects are safe by default and will ignore DTDs even when constructed with an unsafe parser or wrapped in another unsafe parser.
objects are safe by default.
They are set by default to have their ProhibitDtd property set to false in .NET Framework versions 4.0 and earlier, or their
property set to Prohibit in .NET versions 4.0 and later.
Additionally, in .NET versions 4.5.2 and later, the
set to null by default, which provides an additional layer of safety.
objects will only become unsafe in version 4.5.2 and up if both the
property is set to Parse and the
is set to a nonnull XmlResolver with default or unsafe settings. If you need to enable DTD processing, instructions on how to do so safely are described in detail in the
referenced MSDN article
System.Xml.XmlTextReader
by default in .NET Framework versions prior to 4.5.2. Here is how to make it safe in various .NET versions:
In .NET Framework versions prior to 4.0, DTD parsing behavior for
are controlled by the Boolean
property found in the
System.Xml.XmlReaderSettings
System.Xml.XmlTextReader
Set these values to true to disable inline DTDs completely.
// NEEDED because the default is FALSE!!
.NET 4.0 - .NET 4.5.2
In .NET Framework version 4.0, DTD parsing behavior has been changed. The
property has been deprecated in favor of the new
However, they didn't change the default settings so
is still vulnerable to XXE by default.
causes the runtime to throw an exception if a
element is present in the XML.
To set this value yourself, it looks like this:
// NEEDED because the default is Parse!!
Alternatively, you can set the
, which will not throw an exception on encountering a
element but will simply skip over it and not process it. Finally, you can set
if you do want to allow and process inline DTDs.
In .NET Framework versions 4.5.2 and up,
is set to null by default, making the
ignore DTDs by default. The
can become unsafe if you create your own nonnull
with default or unsafe settings.
System.Xml.XPath.XPathNavigator
by default in .NET Framework versions prior to 4.5.2.
This is due to the fact that it implements
, which are also unsafe by default in versions prior to 4.5.2.
safe by giving it a safe parser like
(which is safe by default) in the
For .NET Framework version ≥4.5.2, XPathNavigator is
System.Xml.Xsl.XslCompiledTransform
(an XML transformer) is safe by default as long as the parser it's given is safe.
It is safe by default because the default parser of the
, which is safe by default (per above).
The source code for this method is here.
) as an input, and if you pass in an unsafe XML Parser then the
iOS includes the C/C++ libxml2 library described above, so that guidance applies if you are using libxml2 directly.
However, the version of libxml2 provided up through iOS6 is prior to version 2.9 of libxml2 (which protects against XXE by default).
type, which is built on top of libxml2.
provides some additional protections against XXE that aren't available in libxml2 directly.
Per the 'NSXMLDocument External Entity Restriction API' section of this
iOS4 and earlier: All external entities are loaded by default.
iOS5 and later: Only entities that don't require network access are loaded. (which is safer)
However, to completely disable XXE in an
in any version of iOS you simply specify
NSXMLNodeLoadExternalEntitiesNever
When using the default XML parser (based on libxml2), PHP 8.0 and newer
prevent XXE by default
For PHP versions prior to 8.0, per
the PHP documentation
, the following should be set when using the default PHP XML parser in order to prevent XXE:
libxml_set_external_entity_loader(null);
A description of how to abuse this in PHP is presented in a good
describing a cool PHP based XXE vulnerability that was fixed in Facebook.
The Python 3 official documentation contains a section on
. As of the 1st January 2020 Python 2 is no longer supported, however the Python website still contains
some legacy documentation
The table below shows you which various XML parsing modules in Python 3 are vulnerable to certain XXE attacks.
External Entity Expansion
To protect your application from the applicable attacks,
exist to help you sanitize your input and protect your application against DDoS and remote attacks.
is a command-line tool for offline static analysis. Use pre-built or custom rules to enforce code and security standards in your codebase.
Below are the rules for different XML parsers in Java
Identifying XXE vulnerability in the
org.apache.commons.digester3.Digester
Rule can be played here
https://semgrep.dev/s/salecharohit:xxe-Digester
DocumentBuilderFactory
Identifying XXE vulnerability in the
javax.xml.parsers.DocumentBuilderFactory
Rule can be played here
https://semgrep.dev/s/salecharohit:xxe-dbf
Identifying XXE vulnerability in the
org.jdom2.input.SAXBuilder
Rule can be played here
https://semgrep.dev/s/salecharohit:xxe-saxbuilder
Identifying XXE vulnerability in the
javax.xml.parsers.SAXParserFactory
Rule can be played here
https://semgrep.dev/s/salecharohit:xxe-SAXParserFactory
Identifying XXE vulnerability in the
org.dom4j.io.SAXReader
Rule can be played here
https://semgrep.dev/s/salecharohit:xxe-SAXReader
Identifying XXE vulnerability in the
javax.xml.stream.XMLInputFactory
Rule can be played here
https://semgrep.dev/s/salecharohit:xxe-XMLInputFactory
Identifying XXE vulnerability in the
org.xml.sax.XMLReader
Rule can be played here
https://semgrep.dev/s/salecharohit:xxe-XMLReader
XXE by InfoSecInstitute
OWASP Top 10-2017 A4: XML External Entities (XXE)
Timothy Morgan's 2014 paper: "XML Schema, DTD, and Entity Attacks"
FindSecBugs XXE Detection
Testing for XML Injection